## HTTP历史
- 20 世纪 60 年代，美国国防部高等研究计划署（ARPA）建立了 ARPA 网，它有四个分布在各地的节点，被认为是如今互联网的“始祖”。
- 然后在 70 年代，基于对ARPA网的实践和思考，研究人员发明出了著名的TCP/IP协议。由于具有良好的分层结构和稳定的性能，TCP/IP协议迅速战胜其他竞争对手流行起来，并在 80 年代中期进入了UNIX系统内核，促使更多的计算机接入了互联网。
- 1989 年，任职于欧洲核子研究中心（CERN）的蒂姆·伯纳斯 - 李（Tim Berners-Lee）发表了一篇论文，提出了在互联网上构建超链接文档系统的构想。这篇论文中他确立了三项关键技术：
1. URI：即统一资源标识符，作为互联网上资源的唯一身份；
2. HTML：即超文本标记语言，描述超文本文档；
3. HTTP：即超文本传输协议，用来传输超文本。
- HTTP/0.9：20世纪90年代初期的互联网世界非常简陋，计算机处理能力低，存储容量小，网速很慢，还是一片“信息荒漠”。网络上绝大多数的资源都是纯文本，很多通信协议也都使用纯文本，所以HTTP的设计也不可避免地受到了时代的限制。这一时期的 HTTP 被定义为 0.9 版，结构比较简单，为了便于服务器和客户端处理，它也采用了纯文本格式。只允许用“GET”动作从服务器上获取 HTML 文档，并且在响应请求之后立即关闭连接，功能非常有限。
#### HTTP/1.0：
经过一系列的草案，HTTP/1.0 版本在 1996 年正式发布。它在多方面增强了0.9版，形式上已经和我们现在的 HTTP 差别不大了，例如：
1. 增加了 HEAD、POST 等新方法；
2. 增加了响应状态码，标记可能的错误原因；
3. 引入了协议版本号概念；
4. 引入了 HTTP Header（头部）的概念，让 HTTP 处理请求和响应更加灵活；
5. 传输的数据不再仅限于文本。
HTTP/1.0 并不是一个“标准”，只是记录已有实践和模式的一份参考文档，不具有实际的约束力，相当于一个“备忘录”。
#### HTTP/1.1 
HTTP/1.1 是对HTTP/1.0的小幅度修正，但它是一个“正式的标准”，，今后互联网上所有的浏览器、服务器、网关、代理等等，只要用到HTTP协议，就必须严格遵守这个标准，相当于是互联网世界的一个“立法”。HTTP/1.1 主要的变更点有：
1. 增加了 PUT、DELETE 等新的方法；
2. 增加了缓存管理和控制；
3. 明确了连接管理，允许持久连接；
4. 允许响应数据分块（chunked），利于传输大文件；
5. 强制要求 Host 头，让互联网主机托管成为可能。
#### HTTP/2
- 对HTTP/1.1的不满：连接慢，无法跟上迅猛发展的互联网
- Google 首先开发了自己的浏览器Chrome，然后推出了新的 SPDY 协议
- 互联网标准化组织以 SPDY 为基础开始制定新版本的 HTTP 协议，最终在 2015 年发布了 HTTP/2，RFC 编号 7540
- HTTP/2 的制定充分考虑了现今互联网的现状：宽带、移动、不安全，在高度兼容 HTTP/1.1 的同时在性能改善方面做了很大努力，主要的特点有：
1. 二进制协议，不再是纯文本；
2. 可发起多个请求，废弃了 1.1 里的管道；
3. 使用专用算法压缩头部，减少数据传输量；
4. 允许服务器主动向客户端推送数据；
5. 增强了安全性，“事实上”要求加密通信。
#### HTTP/3
在 HTTP/2 还处于草案之时，Google又发明了一个新的协议，叫做 QUIC,依托它的庞大用户量和数据量，持续地推动 QUIC 协议成为互联网上的“既成事实”。

## HTTP 定义
HTTP（Hyper Text Transfer Protocol）协议的内涵：
- HTTP是一个协议：
1. 协即有多方参与，
2. 议即对参与者的行为约定与规范
- HTTP是传输协议：HTTP 是一个在计算机世界里专门用来在两点之间传输数据的约定和规范
1. HTTP协议是双向协议：有两个基本的参与者
2. 数据在参与者之间传输，允许中转和接力（代理）
3. 相关概念：文本（text）是完整的、有意义的数据，可以被浏览器、服务器这样的上层应用程序处理；超文本（hypertext）“超越了普通文本的文本”，它是文字、图片、音频和视频等的混合体，最关键的是含有“超链接”，能够从一个“超文本”跳跃到另一个“超文本”，形成复杂的非线性、网状的结构关系

## HTTP相关技术
- 浏览器：Firefox，Chrome，IE，Edge
- web服务器：
1. 硬件：含义就是物理形式或“云”形式的机器，在大多数情况下它可能不是一台服务器，而是利用反向代理、负载均衡等技术组成的庞大集群。但从外界看来，它仍然表现为一台机器，但这个形象是“虚拟的”。
2. 软件：它就是提供Web服务的应用程序，通常会运行在硬件含义的服务器上。它利用强大的硬件能力响应海量的客户端 HTTP 请求，处理磁盘上的网页、图片等静态文件，或者把请求转发给后面的 Tomcat、Node.js 等业务应用，返回动态的信息。
3. 举例：apache、nginx、IIS（windows）、Jetty/Tomcat
- CDN<p>
全称是“Content Delivery Network”，“内容分发网络”。它应用了 ==HTTP 协议里的缓存和代理技术==，代替源站响应客户端的请求。
- 爬虫
- HTML/WebService/WAF
1. 是 HTTP 协议传输的主要内容之一，它描述了超文本页面，用各种“标签”定义文字、图片等资源和排版布局，最终由浏览器“渲染”出可视化页面。
2. Web  Service 是一种由 W3C 定义的应用服务开发规范，使用 client-server 主从架构，通常使用 WSDL 定义服务接口，使用 HTTP 协议传输 XML 或 SOAP 消息，也就是说，它是一个基于 Web（HTTP）的服务架构技术，既可以运行在内网，也可以在适当保护后运行在外网。
3. WAF：“网络应用防火墙”，专门检测 HTTP 流量，是防护 Web 应用的安全技术。WAF 通常位于 Web 服务器之前，可以阻止如SQL注入、跨站脚本等攻击，目前应用较多的一个开源项目是ModSecurity，它能够完全集成进 Apache 或 Nginx。

## HTTP相关协议
#### TCP/IP
TCP/IP 协议实际上是一系列网络通信协议的统称，其中最核心的两个协议是TCP和IP，其他的还有UDP、ICMP、ARP等等，共同构成了一个复杂但有层次的协议栈。
![image](97C4237CED7A495A8EE3BFD80C249C67)
- 第一层叫“链接层”（link layer），负责在以太网、WiFi这样的底层网络上发送原始数据包，工作在网卡这个层次，使用MAC地址来标记网络上的设备，所以有时候也叫 MAC 层。
- 第二层叫网际层或者网络互联层（internet layer）”（internet layer），IP 协议就处在这一层。因为 IP 协议定义了“IP 地址”的概念，所以就可以在“链接层”的基础上，用 IP 地址取代 MAC 地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把 IP 地址再“翻译”成 MAC 地址就可以了。
- 第三层叫传输层（transport layer），这个层次协议的职责是保证数据在IP地址标记的两点之间“可靠”地传输，是TCP协议工作的层次，另外还有它的一个“小伙伴”UDP。TCP面向连接，有状态；UDP面向无连接，无状态
- 第四层叫“应用层”，各种不同的应用协议
- MAC 层的传输单位是帧（frame），IP 层的传输单位是包（packet），TCP 层的传输单位是段（segment），HTTP 的传输单位则是消息或报文（message）。但这些名词并没有什么本质的区分，可以统称为数据包。
#### OSI网络分层模型
![image](24BB81569AFA4F89B164D7C20BEEBBE2)
1. 第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等；
2. 第二层：数据链路层，它基本相当于 TCP/IP 的链接层；
3. 第三层：网络层，相当于 TCP/IP 里的网际层；
4. 第四层：传输层，相当于 TCP/IP 里的传输层；
5. 第五层：会话层，维护网络中的连接状态，即保持会话和同步；
6. 第六层：表示层，把数据转换为合适、可理解的语法和语义；
7. 第七层：应用层，面向具体的应用传输数据。

#### TCP/IP与OSI模型之间的关系
![image](F40EBAA3941046C8A3B49816A6589DE3)

#### 包在层次之间的转移
![image](FD8383568C924BBC8A4059D7C64C1C23)
OSI 的分层模型在四层以上分的太细，而 TCP/IP 实际应用时的会话管理、编码转换、压缩等和具体应用经常联系的很紧密，很难分开。例如，HTTP 协议就同时包含了连接管理和数据格式定义。

#### DNS协议
DNS（Domain name system）把域名做一个转换，“映射”到它的真实IP，这就是所谓的“域名解析”

#### URI/URL 
- URI（uniform resource identifier）:统一资源标识符。常用表现形式是URL。分为三部分
1. 协议名：即访问该资源应当使用的协议，在这里是“http”；
2. 主机名：即互联网上主机的标记，可以是域名或 IP 地址，在这里是“nginx.org”；
3. 路径：即资源在主机上的位置，使用“/”分隔多级目录，在这里是“/en/download.html”。
- URL（uniform resource locator）：，也就是我们俗称的“网址”，它实际上是 URI 的一个子集，通常不会做严格的区分。


#### HTTPS
- HTTPS即HTTP over SSL/TLS，就是运行在 SSL/TLS 协议上的 HTTP
- SSL全称是secure socket layer，网景公司发明；到3.0版本的时候改名为TLS，transport Layer security
- SSL 使用了许多密码学最先进的研究成果，综合了对称加密、非对称加密、摘要算法、数字签名、数字证书等技术，能够在不安全的环境中为通信的双方创建出一个秘密的、安全的传输通道，为HTTP套上一副坚固的盔甲。


#### 代理
- 代理（Proxy）是HTTP协议中请求方和应答方中间的一个环节，作为“中转站”，既可以转发客户端的请求，也可以转发服务器的应答。
- 代理的种类
1. 匿名代理：完全“隐匿”了被代理的机器，外界看到的只是代理服务器；
2. 透明代理：顾名思义，它在传输过程中是“透明开放”的，外界既知道代理，也知道客户端；
3. 正向代理：靠近客户端，代表客户端向服务器发送请求；
4. 反向代理：靠近服务器端，代表服务器响应客户端的请求

- 由于代理在传输过程中插入了一个“中间层”，所以可以在这个环节做很多有意思的事情，比如：
1. 负载均衡：把访问请求均匀分散到多台机器，实现访问集群化；
2. 内容缓存：暂存上下行的数据，减轻后端的压力；
3. 安全防护：隐匿 IP, 使用 WAF 等工具抵御网络攻击，保护被代理的机器；
4. 数据处理：提供压缩、加密等额外的功能。

- 关于 HTTP 的代理还有一个特殊的“代理协议”（proxy protocol），它由知名的代理软件HAProxy制订，但并不是RFC标准

## 域名系统
#### 域名的形式
- 域名是一个有层次的结构，是一串用“.”分隔的多个单词，最右边的被称为“顶级域名”，然后是“二级域名”，层级关系向左依次降低。
- 在 Apache、Nginx 这样的 Web 服务器里，域名可以用来标识虚拟主机，决定由哪个虚拟主机来对外提供服务，比如在 Nginx 里就会使用“server_name”指令：

```
server {
    listen 80;                       # 监听 80 端口
    server_name  time.geekbang.org;  # 主机名是 time.geekbang.org
    ...
}

```
#### 域名的解析
- 域名转换成 IP 地址的过程就是“域名解析”
- DNS 的核心系统是一个三层的树状、分布式服务，基本对应域名的结构
1. 根域名服务器（Root DNS Server）：管理顶级域名服务器，返回“com”“net”“cn”等顶级域名服务器的 IP 地址；
2. 顶级域名服务器（Top-level DNS Server）：管理各自域名下的权威域名服务器，比如 com 顶级域名服务器可以返回 apple.com 域名服务器的 IP 地址；
3. 权威域名服务器（Authoritative DNS Server）：管理自己域名下主机的 IP 地址，比如 apple.com 权威域名服务器可以返回 www.apple.com 的 IP 地址。
![image](4A7FD770364448D39D35C82E2775431A)
- 根域名服务器是关键，它必须是众所周知的，目前全世界共有 13 组根域名服务器，又有数百台的镜像，保证一定能够被访问到
- 域名查询举例（www.apple.com）：
1. 访问根域名服务器，它会告诉你“com”顶级域名服务器的地址；
2. 访问“com”顶级域名服务器，它再告诉你“apple.com”域名服务器的地址；
3. 最后访问“apple.com”域名服务器，就得到了“www.apple.com”的地址。
- 所以在核心 DNS系统之外，还有两种手段用来减轻域名解析的压力，并且能够更快地获取结果，基本思路就是“缓存”
1. 许多大公司、网络运行商都会建立自己的 DNS 服务器，作为用户DNS查询的代理，被称为“非权威域名服务器”，可以缓存之前的查询结果
2. 其次，操作系统里也会对DNS解析结果做缓存
- 在 Nginx 里有一条配置指令“resolver”，它就是用来配置 DNS 服务器的

```
resolver 8.8.8.8 valid=30s;  # 指定 Google 的 DNS，缓存 30 秒

```
#### 域名的新玩法
- “重定向”
- bind9 等开源软件搭建一个在内部使用的 DNS，作为名字服务器
- 基于域名的负载均衡
- 恶意DNS
1. “域名屏蔽”，对域名直接不解析，返回错误，让你无法拿到 IP 地址，也就无法访问网站；
2. “域名劫持”，也叫“域名污染”，你要访问 A 网站，但 DNS 给了你 B 网站。

## HTTP实验环境
- wireshark
- chrome/firefox
- Telent
- OpenResty