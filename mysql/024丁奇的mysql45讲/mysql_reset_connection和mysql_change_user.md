## mysql_change_user函数

- 修改用户账号，并将该账号当前数据库改成由参数db指定的数据库
- 接下来的查询涉及的表默认都是指该数据库下的，除非显式的指定库名。
- 当该账号认证失败或者没有指定库权限时，会报告 change_user 失败。

作用：重置所有会话状态，并且重新认证。

行为：
1. 回滚所有活跃事务，
2. 关闭&删除所有临时表，
3. 释放所有表锁，
4. 重置所有会话变量(选项)使之和全局变量一致，
5. 如果有PREPARE语句会被释放（其相应的HANDLER也会被关闭），利用GET_LOCK获取的锁会被释放。
6. ==注意：这些工作即便change user没成功也会执行。==

如果只是想重置会话状态，不想change user这么重，则可以改成 mysql_reset_connection 函数。

## mysql_reset_connection函数

mysql_reset_connection 函数的作用是重置会话状态，类似做了一次无需断开和连接的快速“重连”操作，会话历史也会被清空。

下列会话状态会被影响：

1. 活跃事务会被回滚，自动提交模式也会被重置；
2. 释放所有表锁；
3. 关闭&删除所有临时表；
4. 会话变量(选项)被重置成和全局变量一致；
5. 用户级变量丢失；
6. PREPARE语句会被释放（其相应的HANDLER也会被关闭）；
7. LAST_INSERT_ID值重置为0；
8. 利用GET_LOCK获取的锁会被释放。

它和mysql_change_user的主要区别就在于无需重新连接、指定DB，以及重新验证账号，相对更轻量级一些，因此优先建议选用 mysql_reset_connection 函数