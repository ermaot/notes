## 如何选择时间和日期变量类型
- 使用CCYY-MM-DD 格式的字符串来处理DATE类型值,DATE值的有效范围从1000-01-01到9999-12-31
- 使用格式hh:mm:ss字符串来保存TIME类型变量值,时间值通常被当作是某天中的某个时间,但实际上在MySQL将时间作为一个连续的值,可以从过去的某一个时间点开始计算.因此,TIME类型的值可能大于23:59:59, 也可能是一个负数(实际上,TIME类型的取值范围是-838:59:59到838:59:59)
- DATETIME和TIMESTAMP类型使用CCYY-MM-DD hh:mm:ss 格式的字符穿来保存时间和日期的一个组合值
- DATETIME 类型变量的取值范围为1000-01-0100:00:00到9999-12-3123:59:59, 而TIMESTAMP仅为1970-01-0100:00:00 到2037-12-3123:59:59.
- TIMESTAMP类型具有自动初始化和自动更新的特性
- 当客户端向数据库中插入一个TIMESTAMP类型值时,服务器将该值从客户端所属时区转换到UTC,然后将该值保存为一个UTC时间值.当客户端从服务器查询这个TIMESTAMP值时,将UtC值转换为客户端时区时间值
## 如何显示日期和时间

格式化字符| 含义
---|---
%Y |年份,数字形式,4位数
%y |年份,数字形式,2位数
%M |完整的月份名称(January-December)
%b |月份名称的前三个字母(Jan-Dec)
%m |月份,数字形式(01..12)
%c |月份,数字形式(1..12)
%d |该月日期,数字形式 (01..31)
%e |该月日期,数字形式(1..31)
%W |工作日名称(Sunday..Saturday)
%r|时间,12小时制,以AM或PM结尾
%T |时间,24小时制
%H |小时,数字形式,2位数(00..23)
%i |分钟,数字形式,2位数(00..59)
%s |秒,数字形式,2位数(00..59)
%% |'%'文字字符


```
> select  date_format(a, '%m %d, %y'),date_format(a, '%M %D, %Y') from  datetest limit 1;
+-----------------------------+-----------------------------+
| date_format(a, '%m %d, %y') | date_format(a, '%M %D, %Y') |
+-----------------------------+-----------------------------+
| 07 12, 19                   | July 12th, 2019             |
+-----------------------------+-----------------------------+
1 row in set (0.00 sec)

> select date_format(a,'%b') b,date_format(a,"%c") c,date_format(a,"%m") m,date_format(a,"%e") e,date_format(a,"%W") W,date_format(a,"%r") r ,date_format(a,"%T") T ,date_format(a,"%H") H,date_format(a,"%i") i,date_format(a,"%s") s ,date_format(a,"%%") '%' from timestamptest;
+------+------+------+------+-----------+-------------+----------+------+------+------+------+
| b    | c    | m    | e    | W         | r           | T        | H    | i    | s    | %    |
+------+------+------+------+-----------+-------------+----------+------+------+------+------+
| Jul  | 7    | 07   | 17   | Wednesday | 02:30:11 PM | 14:30:11 | 14   | 30   | 11   | %    |
+------+------+------+------+-----------+-------------+----------+------+------+------+------+
1 row in set (0.00 sec)

//time_format与此相关的格式才能使用，否则为NULL；同时不同的版本稍有不同
//mysql8.0.16
> select time_format(a,'%b') b,time_format(a,"%c") c,time_format(a,"%m") m,time_format(a,"%e") e,time_format(a,"%W") W,time_format(a,"%r") r ,time_format(a,"%T") T ,time_format(a,"%H") H,time_format(a,"%i") i,time_format(a,"%s") s ,time_format(a,"%%") '%' from timestamptest;
+------+------+------+------+------+-------------+----------+------+------+------+------+
| b    | c    | m    | e    | W    | r           | T        | H    | i    | s    | %    |
+------+------+------+------+------+-------------+----------+------+------+------+------+
| NULL | 0    | 00   | 0    | NULL | 02:30:11 PM | 14:30:11 | 14   | 30   | 11   | %    |
+------+------+------+------+------+-------------+----------+------+------+------+------+
1 row in set (0.00 sec)


//5.5.56-MariaDB
> select time_format(a,'%b') b,time_format(a,"%c") c,time_format(a,"%m") m,time_format(a,"%e") e,time_format(a,"%W") W,time_format(a,"%r") r ,time_format(a,"%T") T ,time_format(a,"%H") H,time_format(a,"%i") i,time_format(a,"%s") s ,time_format(a,"%%") '%' from timestamptest;
+------+------+------+------+------+-------------+----------+------+------+------+------+
| b    | c    | m    | e    | W    | r           | T        | H    | i    | s    | %    |
+------+------+------+------+------+-------------+----------+------+------+------+------+
| Jul  | 7    | 07   | 17   | NULL | 02:40:23 PM | 14:40:23 | 14   | 40   | 23   | %    |
+------+------+------+------+------+-------------+----------+------+------+------+------+
1 row in set (0.00 sec)

> select str_to_date('MAY 3th 2007' ,'%M  %D %Y'),str_to_date('5 ,3 07','%m ,%d %y') ;
+------------------------------------------+------------------------------------+
| str_to_date('MAY 3th 2007' ,'%M  %D %Y') | str_to_date('5 ,3 07','%m ,%d %y') |
+------------------------------------------+------------------------------------+
| 2007-05-03                               | 2007-05-03                         |
+------------------------------------------+------------------------------------+
1 row in set (0.00 sec)
//注意逗号需要位置对应
```

## 更改客户端时区
获取当前客户端时区

```
> select @@global.time_zone,@@session.time_zone;
+--------------------+---------------------+
| @@global.time_zone | @@session.time_zone |
+--------------------+---------------------+
| SYSTEM             | SYSTEM              |
+--------------------+---------------------+
1 row in set (0.00 sec)


```
时区转换

```
> select convert_tz("2014-11-13 18:58:07", '-06:00', '+6:00') ;
+------------------------------------------------------+
| convert_tz("2014-11-13 18:58:07", '-06:00', '+6:00') |
+------------------------------------------------------+
| 2014-11-14 06:58:07                                  |
+------------------------------------------------------+
1 row in set (0.00 sec)
```
时区设置

```
 > set session time_zone = '+04:00' ;
```

## 获取当前日期或时间

```
> select current_date,current_timestamp,current_time ,curdate(), curtime(), now(), utc_date(), utc_time(), utc_timestamp();
+--------------+---------------------+--------------+------------+-----------+---------------------+------------+------------+---------------------+
| current_date | current_timestamp   | current_time | curdate()  | curtime() | now()               | utc_date() | utc_time() | utc_timestamp()     |
+--------------+---------------------+--------------+------------+-----------+---------------------+------------+------------+---------------------+
| 2019-07-17   | 2019-07-17 11:19:25 | 11:19:25     | 2019-07-17 | 11:19:25  | 2019-07-17 11:19:25 | 2019-07-17 | 07:19:25   | 2019-07-17 07:19:25 |
+--------------+---------------------+--------------+------------+-----------+---------------------+------------+------------+---------------------+

```

## 使用timestamp记录每一行数据的修改时间
timestamp在mysql8之前的版本，默认会以当前时间为默认，且会自动更新
```
create table t ( t_create timestamp default current_timestamp) ;					//current_timestamp 保留创建时间

create table t ( t_create timestamp d) ;
//如果是maria5.5，有默认当前时间和自动更新属性
> show create table t;
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                                  |
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------+
| t     | CREATE TABLE `t` (
  `t_create` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8 |
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------+

//如果是mysql8，无此特性
> show create table t;
+-------+--------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                   |
+-------+--------------------------------------------------------------------------------------------------------------------------------+
| t     | CREATE TABLE `t` (
  `t_create` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+--------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.01 sec)
```
- 当插入一个新行的时候，自动初始化为当前时间
- 修改值的时候，更新为当前时间
- 一张表中有多个timestamp列，只有一个列有这个属性，其余列需要手动更新
## 分解日期和时间值

```
>  select a , date(a), time(a), year(a), month(a), monthname(a), dayofmonth(a), dayname(a),left(dayname(a),3) ,dayofweek(a), dayofyear(a), hour(a), minute(a), second(a) from timestamptest ;
+---------------------+------------+----------+---------+----------+--------------+---------------+------------+--------------------+--------------+--------------+---------+-----------+-----------+
| a                   | date(a)    | time(a)  | year(a) | month(a) | monthname(a) | dayofmonth(a) | dayname(a) | left(dayname(a),3) | dayofweek(a) | dayofyear(a) | hour(a) | minute(a) | second(a) |
+---------------------+------------+----------+---------+----------+--------------+---------------+------------+--------------------+--------------+--------------+---------+-----------+-----------+
| 2019-07-17 10:30:11 | 2019-07-17 | 10:30:11 |    2019 |        7 | July         |            17 | Wednesday  | Wed                |            4 |          198 |      10 |        30 |        11 |
+---------------------+------------+----------+---------+----------+--------------+---------------+------------+--------------------+--------------+--------------+---------+-----------+-----------+
1 row in set (0.00 sec)
```

## 合成日期和时间值

```
> select maketime(17, 20, 59) ,makedate(2014, 50) ;
+----------------------+--------------------+
| maketime(17, 20, 59) | makedate(2014, 50) |
+----------------------+--------------------+
| 17:20:59             | 2014-02-19         |
+----------------------+--------------------+
1 row in set (0.00 sec)

//可以看到time最大值和date最大值，而且看到如果超过最大值，两个函数的不同表现
> select maketime(2009, 20, 59) ,makedate(10000, 50) ;
+------------------------+---------------------+
| maketime(2009, 20, 59) | makedate(10000, 50) |
+------------------------+---------------------+
| 838:59:59              | NULL                |
+------------------------+---------------------+
1 row in set, 1 warning (0.00 sec)

> select time_to_sec(now()), to_days(now()) ,sec_to_time(42913);
+--------------------+----------------+--------------------+
| time_to_sec(now()) | to_days(now()) | sec_to_time(42913) |
+--------------------+----------------+--------------------+
|              43000 |         737622 | 11:55:13           |
+--------------------+----------------+--------------------+
1 row in set (0.00 sec)
```

## 日期和时间值的转换以及基本单位

```
> select time_to_sec(now()), to_days(now()),from_days("736987");
+--------------------+----------------+---------------------+
| time_to_sec(now()) | to_days(now()) | from_days("736987") |
+--------------------+----------------+---------------------+
|              43561 |         737622 | 2017-10-20          |
+--------------------+----------------+---------------------+
```

## 日期和时间的运算
unix_timestamp()转化值为日期；而from_unixtime()相反
```

> select unix_timestamp(now())  t, from_unixtime(unix_timestamp(now())) ;
+------------+--------------------------------------+
| t          | from_unixtime(unix_timestamp(now())) |
+------------+--------------------------------------+
| 1563350822 | 2019-07-17 12:07:02                  |
+------------+--------------------------------------+
1 row in set (0.00 sec)
```
计算时间差

```
select datediff("2014-11-12 18:58:07","2014-11-13 18:58:07"),  timediff("2014-11-12 18:58:07","2014-11-13 18:58:07") ,timestampdiff(hour,"2014-11-12 18:58:07","2014-11-13 18:58:07");	//时间差

+-------------------------------------------------------+-------------------------------------------------------+-----------------------------------------------------------------+
| datediff("2014-11-12 18:58:07","2014-11-13 18:58:07") | timediff("2014-11-12 18:58:07","2014-11-13 18:58:07") | timestampdiff(hour,"2014-11-12 18:58:07","2014-11-13 18:58:07") |
+-------------------------------------------------------+-------------------------------------------------------+-----------------------------------------------------------------+
|                                                    -1 | -24:00:00                                             |                                                              24 |
+-------------------------------------------------------+-------------------------------------------------------+-----------------------------------------------------------------+
1 row in set (0.00 sec)
```
增减时间段

```
> select addtime("2014-11-12 18:58:07", "14:00:00"), timestamp("2014-11-12", "10:00:00") ;
+--------------------------------------------+-------------------------------------+
| addtime("2014-11-12 18:58:07", "14:00:00") | timestamp("2014-11-12", "10:00:00") |
+--------------------------------------------+-------------------------------------+
| 2014-11-13 08:58:07                        | 2014-11-12 10:00:00                 |
+--------------------------------------------+-------------------------------------+

> select date_add("2014:11-12",interval 2 minute),date_sub("2014:11-12",interval 1 day);
+------------------------------------------+---------------------------------------+
| date_add("2014:11-12",interval 2 minute) | date_sub("2014:11-12",interval 1 day) |
+------------------------------------------+---------------------------------------+
| 2014-11-12 00:02:00                      | 2014-11-11                            |
+------------------------------------------+---------------------------------------+
1 row in set (0.00 sec)

//timestamp可以直接减去一个interval
> select date_add("2014:11-12",interval "14 30" hour_minute),now()-interval "1 12 " day_hour;
+-----------------------------------------------------+---------------------------------+
| date_add("2014:11-12",interval "14 30" hour_minute) | now()-interval "1 12 " day_hour |
+-----------------------------------------------------+---------------------------------+
| 2014-11-12 14:30:00                                 | 2019-07-16 00:27:08             |
+-----------------------------------------------------+---------------------------------+
1 row in set (0.00 sec)
```
查看某月最后一天

```
> select last_day(now());
+-----------------+
| last_day(now()) |
+-----------------+
| 2019-07-31      |
+-----------------+
```

## 将日期和时间值作为控制条件来查询
直接使用＞＜或者between
```
select * from test where d between '2014-11-12' and '2015-11-12' ;
select * from test where d > '2015-11-12' ;
```
