## 相关文件
主要文件: ibuf0*.*，代码行数: 3232

文件名| 代码行数 |说明
---|---|---
ibuf0ibuf.C |2723|
ibuf0ibuf.h |283 |Insert Buffer 实现
ibuf0ibuf.ic |226|
## 基本概念
- insert buffer 是innodb引擎独有，大幅提高数据库==非唯一约束的辅助索引==插入性能
- 大批量导入数据时，一般建议不建立辅助索引，当数据导入完成后再一次性创建辅助索引
- insert buffer设计思想是，插入前判断插入的辅助索引叶子是否在缓冲池中，若在则直接插入，否则将插入的记录放入insert buffer，然后根据算法将insert buffer缓存的记录通过后台线程主键合并到辅助索引页，可减少磁盘的离散读并合并多次插入为一次
## 架构实现
- insert buffer 结构是B+树，键值是待插入到辅助索引页的page_no，页大小为16KB，内存使用缓冲池
- 宏IBUF_POOL_SIZE_PER_MAX_SIZE定义了insert buffer最多占用缓冲池中页的数量，默认为2，即最多可能占用二分之一缓冲池大小
#### 存储结构
#### 逻辑控制
#### 示例
## 相关数据结构
## 死锁
#### latch顺序
#### 并发控制
#### 异步IO线程
## 维护
#### 记录合并
#### 空间收缩
